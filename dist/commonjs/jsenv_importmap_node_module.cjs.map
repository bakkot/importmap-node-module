{
  "version": 3,
  "file": "jsenv_importmap_node_module.cjs",
  "sources": [
    "../../src/internal/logs.js",
    "../../src/internal/resolveFile.js",
    "../../src/internal/from-package/resolvePackageMain.js",
    "../../src/internal/from-package/visitPackageImportMap.js",
    "../../src/internal/from-package/specifierIsRelative.js",
    "../../src/internal/from-package/visitPackageImports.js",
    "../../src/internal/from-package/visitPackageExports.js",
    "../../src/internal/memoizeAsyncFunction.js",
    "../../src/internal/from-package/readPackageFile.js",
    "../../src/internal/from-package/applyPackageManualOverride.js",
    "../../src/internal/from-package/node-module-resolution.js",
    "../../src/internal/from-package/visitNodeModuleResolution.js",
    "../../src/internal/optimizeImportMap.js",
    "../../node_modules/@jsenv/core/helpers/import-meta/import-meta-url-commonjs.js",
    "../../src/internal/from-js/parseSpecifiersFromFile.js",
    "../../src/internal/from-js/showSource.js",
    "../../src/internal/from-js/visitSourceFiles.js",
    "../../src/internal/importMapToVsCodeConfigPaths.js",
    "../../src/writeImportMapFiles.js"
  ],
  "sourcesContent": [
    "import { createDetailedMessage } from \"@jsenv/logger\"\nimport {\n  urlToFileSystemPath,\n  urlToRelativeUrl,\n  resolveUrl,\n} from \"@jsenv/filesystem\"\n\nexport const createPackageNameMustBeAStringWarning = ({\n  packageName,\n  packageInfo,\n}) => {\n  return {\n    code: \"PACKAGE_NAME_MUST_BE_A_STRING\",\n    message: `package name field must be a string\n--- package name field ---\n${packageName}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo.url)}`,\n  }\n}\n\nexport const createImportResolutionFailedWarning = ({\n  specifier,\n  importedBy,\n  gotBareSpecifierError,\n  magicExtension,\n  suggestsNodeRuntime,\n  automapping,\n}) => {\n  return {\n    code: \"IMPORT_RESOLUTION_FAILED\",\n    message: createDetailedMessage(\n      `Import resolution failed for \"${specifier}\"`,\n      {\n        \"import source\": importedBy,\n        \"reason\": gotBareSpecifierError\n          ? `there is no mapping for this bare specifier`\n          : `file not found on filesystem`,\n        ...getImportResolutionFailedSuggestions({\n          suggestsNodeRuntime,\n          gotBareSpecifierError,\n          magicExtension,\n          automapping,\n        }),\n        // \"extensions tried\": magicExtensions.join(`, `),\n      },\n    ),\n  }\n}\n\nexport const createBareSpecifierAutomappingMessage = ({\n  specifier,\n  importedBy,\n  automapping,\n}) => {\n  return createDetailedMessage(`Auto mapping for \"${specifier}\"`, {\n    \"import source\": importedBy,\n    \"mapping\": mappingToImportmapString(automapping),\n    \"reason\": `bare specifier and \"bareSpecifierAutomapping\" enabled`,\n  })\n}\n\nexport const createExtensionLessAutomappingMessage = ({\n  specifier,\n  importedBy,\n  automapping,\n  mappingFoundInPackageExports,\n}) => {\n  return createDetailedMessage(`Auto mapping for \"${specifier}\"`, {\n    \"import source\": importedBy,\n    \"mapping\": mappingToImportmapString(automapping),\n    \"reason\": mappingFoundInPackageExports\n      ? `no file extension and mapping found in package exports`\n      : `no file extension and \"bareSpecifierAutomapping\" enabled`,\n  })\n}\n\nconst getImportResolutionFailedSuggestions = ({\n  suggestsNodeRuntime,\n  gotBareSpecifierError,\n  magicExtension,\n  automapping,\n}) => {\n  const suggestions = {}\n\n  const addSuggestion = (suggestion) => {\n    const suggestionCount = Object.keys(suggestions).length\n    suggestions[`suggestion ${suggestionCount + 1}`] = suggestion\n  }\n\n  if (suggestsNodeRuntime) {\n    addSuggestion(`use runtime: \"node\"`)\n  }\n  if (automapping) {\n    addSuggestion(\n      `update import specifier to \"${mappingToUrlRelativeToFile(automapping)}\"`,\n    )\n    if (gotBareSpecifierError) {\n      addSuggestion(`use bareSpecifierAutomapping: true`)\n    }\n    if (magicExtension) {\n      addSuggestion(`use extensionlessAutomapping: true`)\n    }\n    addSuggestion(`add mapping to \"initialImportMap\"\n${mappingToImportmapString(automapping)}`)\n  }\n\n  return suggestions\n}\n\nconst mappingToUrlRelativeToFile = (mapping) => {\n  if (!mapping.scope) {\n    return mapping.to\n  }\n  const scopeUrl = resolveUrl(mapping.scope, \"file:///\")\n  const toUrl = resolveUrl(mapping.to, \"file:///\")\n  return `./${urlToRelativeUrl(toUrl, scopeUrl)}`\n}\n\nconst mappingToImportmapString = ({ scope, from, to }) => {\n  if (scope) {\n    return JSON.stringify(\n      {\n        scopes: {\n          [scope]: {\n            [from]: to,\n          },\n        },\n      },\n      null,\n      \"  \",\n    )\n  }\n\n  return JSON.stringify(\n    {\n      imports: {\n        [from]: to,\n      },\n    },\n    null,\n    \"  \",\n  )\n}\n\n// const mappingToExportsFieldString = ({ scope, from, to }) => {\n//   if (scope) {\n//     const scopeUrl = resolveUrl(scope, \"file://\")\n//     const toUrl = resolveUrl(to, \"file://\")\n//     to = `./${urlToRelativeUrl(toUrl, scopeUrl)}`\n//   }\n\n//   return JSON.stringify(\n//     {\n//       exports: {\n//         [from]: to,\n//       },\n//     },\n//     null,\n//     \"  \",\n//   )\n// }\n",
    "import {\n  resolveUrl,\n  readFileSystemNodeStat,\n  urlToFilename,\n  urlToExtension,\n} from \"@jsenv/filesystem\"\nimport { firstOperationMatching } from \"@jsenv/cancellation\"\n\nexport const resolveFile = async (\n  fileUrl,\n  { magicDirectoryIndexEnabled, magicExtensionEnabled, magicExtensions },\n) => {\n  const fileStat = await readFileSystemNodeStat(fileUrl, {\n    nullIfNotFound: true,\n  })\n\n  // file found\n  if (fileStat && fileStat.isFile()) {\n    return {\n      found: true,\n      url: fileUrl,\n    }\n  }\n\n  // directory found\n  if (fileStat && fileStat.isDirectory()) {\n    if (magicDirectoryIndexEnabled) {\n      const indexFileSuffix = fileUrl.endsWith(\"/\") ? \"index\" : \"/index\"\n      const indexFileUrl = `${fileUrl}${indexFileSuffix}`\n      const result = await resolveFile(indexFileUrl, {\n        magicExtensionEnabled,\n        magicDirectoryIndexEnabled: false,\n        magicExtensions,\n      })\n      return {\n        magicDirectoryIndex: true,\n        ...result,\n      }\n    }\n\n    return {\n      found: false,\n      url: fileUrl,\n    }\n  }\n\n  if (!magicExtensionEnabled) {\n    return {\n      found: false,\n      url: fileUrl,\n    }\n  }\n\n  // file already has an extension, magic extension cannot be used\n  const extension = urlToExtension(fileUrl)\n  if (extension !== \"\") {\n    return {\n      found: false,\n      url: fileUrl,\n    }\n  }\n\n  const extensionLeadingToAFile = await findExtensionLeadingToFile(\n    fileUrl,\n    magicExtensions,\n  )\n  // magic extension not found\n  if (extensionLeadingToAFile === null) {\n    return {\n      found: false,\n      url: fileUrl,\n    }\n  }\n  // magic extension worked\n  return {\n    magicExtension: extensionLeadingToAFile,\n    found: true,\n    url: `${fileUrl}${extensionLeadingToAFile}`,\n  }\n}\n\nconst findExtensionLeadingToFile = async (fileUrl, magicExtensions) => {\n  const urlDirectoryUrl = resolveUrl(\"./\", fileUrl)\n  const urlFilename = urlToFilename(fileUrl)\n  const extensionLeadingToFile = await firstOperationMatching({\n    array: magicExtensions,\n    start: async (extensionCandidate) => {\n      const urlCandidate = `${urlDirectoryUrl}${urlFilename}${extensionCandidate}`\n      const stats = await readFileSystemNodeStat(urlCandidate, {\n        nullIfNotFound: true,\n      })\n      return stats && stats.isFile() ? extensionCandidate : null\n    },\n    predicate: (extension) => Boolean(extension),\n  })\n  return extensionLeadingToFile || null\n}\n",
    "import { createDetailedMessage } from \"@jsenv/logger\"\nimport {\n  resolveUrl,\n  urlToFileSystemPath,\n  urlToExtension,\n} from \"@jsenv/filesystem\"\nimport { resolveFile } from \"../resolveFile.js\"\n\nexport const resolvePackageMain = ({\n  warn,\n  packageInfo,\n  // nodeResolutionConditions = [],\n}) => {\n  if (\"main\" in packageInfo.object) {\n    return resolveMainFile({\n      warn,\n      packageFileUrl: packageInfo.url,\n      packageMainFieldName: \"main\",\n      packageMainFieldValue: packageInfo.object.main,\n    })\n  }\n\n  return resolveMainFile({\n    warn,\n    packageFileUrl: packageInfo.url,\n    packageMainFieldName: \"default\",\n    packageMainFieldValue: \"index\",\n  })\n}\n\nconst resolveMainFile = async ({\n  warn,\n  packageFileUrl,\n  packageMainFieldName,\n  packageMainFieldValue,\n}) => {\n  // main is explicitely empty meaning\n  // it is assumed that we should not find a file\n  if (packageMainFieldValue === \"\") {\n    return null\n  }\n\n  const packageDirectoryUrl = resolveUrl(\"./\", packageFileUrl)\n  const mainFileRelativeUrl = packageMainFieldValue.endsWith(\"/\")\n    ? `${packageMainFieldValue}index`\n    : packageMainFieldValue\n\n  const mainFileUrlFirstCandidate = resolveUrl(\n    mainFileRelativeUrl,\n    packageFileUrl,\n  )\n\n  if (!mainFileUrlFirstCandidate.startsWith(packageDirectoryUrl)) {\n    warn(\n      createPackageMainFileMustBeRelativeWarning({\n        packageMainFieldName,\n        packageMainFieldValue,\n        packageFileUrl,\n      }),\n    )\n    return null\n  }\n\n  const { found, url } = await resolveFile(mainFileUrlFirstCandidate, {\n    magicDirectoryIndexEnabled: true,\n    magicExtensionEnabled: true,\n    magicExtensions: [\".js\", \".json\", \".node\"],\n  })\n\n  if (!found) {\n    // we know in advance this remapping does not lead to an actual file.\n    // we only warn because we have no guarantee this remapping will actually be used\n    // in the codebase.\n    // warn only if there is actually a main field\n    // otherwise the package.json is missing the main field\n    // it certainly means it's not important\n    if (packageMainFieldName !== \"default\") {\n      warn(\n        createPackageMainFileNotFoundWarning({\n          specifier: packageMainFieldValue,\n          importedIn: `${packageFileUrl}#${packageMainFieldName}`,\n          fileUrl: mainFileUrlFirstCandidate,\n          magicExtensions: [\".js\", \".json\", \".node\"],\n        }),\n      )\n    }\n    return mainFileUrlFirstCandidate\n  }\n\n  return url\n}\n\nconst createPackageMainFileMustBeRelativeWarning = ({\n  packageMainFieldName,\n  packageMainFieldValue,\n  packageFileUrl,\n}) => {\n  return {\n    code: \"PACKAGE_MAIN_FILE_MUST_BE_RELATIVE\",\n    message: `${packageMainFieldName} field in package.json must be inside package.json folder.\n--- ${packageMainFieldName} ---\n${packageMainFieldValue}\n--- package.json path ---\n${urlToFileSystemPath(packageFileUrl)}`,\n  }\n}\n\nconst createPackageMainFileNotFoundWarning = ({\n  specifier,\n  importedIn,\n  fileUrl,\n  magicExtensions,\n}) => {\n  return {\n    code: \"PACKAGE_MAIN_FILE_NOT_FOUND\",\n    message: createDetailedMessage(\n      `Cannot find package main file \"${specifier}\"`,\n      {\n        \"imported in\": importedIn,\n        \"file url tried\": fileUrl,\n        ...(urlToExtension(fileUrl) === \"\"\n          ? { [\"extensions tried\"]: magicExtensions.join(`, `) }\n          : {}),\n      },\n    ),\n  }\n}\n",
    "import { resolveUrl, moveImportMap } from \"@jsenv/importmap\"\nimport { readFile, urlToFileSystemPath } from \"@jsenv/filesystem\"\n\nexport const visitPackageImportMap = async ({\n  warn,\n  packageInfo,\n  packageImportmap = packageInfo.object.importmap,\n  projectDirectoryUrl,\n}) => {\n  if (typeof packageImportmap === \"undefined\") {\n    return {}\n  }\n\n  if (typeof packageImportmap === \"string\") {\n    const importmapFileUrl = resolveUrl(packageImportmap, packageInfo.url)\n    try {\n      const importmap = await readFile(importmapFileUrl, { as: \"json\" })\n      return moveImportMap(importmap, importmapFileUrl, projectDirectoryUrl)\n    } catch (e) {\n      if (e.code === \"ENOENT\") {\n        warn(\n          createPackageImportMapNotFoundWarning({\n            importmapFileUrl,\n            packageInfo,\n          }),\n        )\n        return {}\n      }\n      throw e\n    }\n  }\n\n  if (typeof packageImportmap === \"object\" && packageImportmap !== null) {\n    return packageImportmap\n  }\n\n  warn(\n    createPackageImportMapUnexpectedWarning({\n      packageImportmap,\n      packageInfo,\n    }),\n  )\n  return {}\n}\n\nconst createPackageImportMapNotFoundWarning = ({\n  importmapFileUrl,\n  packageInfo,\n}) => {\n  return {\n    code: \"PACKAGE_IMPORTMAP_NOT_FOUND\",\n    message: `importmap file specified in a package.json cannot be found,\n--- importmap file path ---\n${importmapFileUrl}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo.url)}`,\n  }\n}\n\nconst createPackageImportMapUnexpectedWarning = ({\n  packageImportmap,\n  packageInfo,\n}) => {\n  return {\n    code: \"PACKAGE_IMPORTMAP_UNEXPECTED\",\n    message: `unexpected value in package.json importmap field: value must be a string or an object.\n--- value ---\n${packageImportmap}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo.url)}`,\n  }\n}\n",
    "export const specifierIsRelative = (specifier) => {\n  if (specifier.startsWith(\"//\")) {\n    return false\n  }\n  if (specifier.startsWith(\"../\")) {\n    return false\n  }\n  // starts with http:// or file:// or ftp: for instance\n  if (/^[a-zA-Z]+\\:/.test(specifier)) {\n    return false\n  }\n  return true\n}\n",
    "/*\n\nhttps://nodejs.org/docs/latest-v15.x/api/packages.html#packages_node_js_package_json_field_definitions\n\n*/\n\nimport { urlToFileSystemPath } from \"@jsenv/filesystem\"\nimport { specifierIsRelative } from \"./specifierIsRelative.js\"\n\nexport const visitPackageImports = ({\n  warn,\n  packageInfo,\n  packageImports = packageInfo.object.imports,\n  packageConditions,\n}) => {\n  const importsSubpaths = {}\n  const onImportsSubpath = ({ key, value, trace }) => {\n    if (!specifierIsRelative(value)) {\n      warn(\n        createSubpathValueMustBeRelativeWarning({\n          value,\n          valueTrace: trace,\n          packageInfo,\n        }),\n      )\n      return\n    }\n\n    const keyNormalized = key\n    const valueNormalized = value\n    importsSubpaths[keyNormalized] = valueNormalized\n  }\n\n  const visitSubpathValue = (subpathValue, subpathValueTrace) => {\n    if (typeof subpathValue === \"string\") {\n      return handleString(subpathValue, subpathValueTrace)\n    }\n\n    if (typeof subpathValue === \"object\" && subpathValue !== null) {\n      return handleObject(subpathValue, subpathValueTrace)\n    }\n\n    return handleRemaining(subpathValue, subpathValueTrace)\n  }\n\n  const handleString = (subpathValue, subpathValueTrace) => {\n    const firstBareKey = subpathValueTrace\n      .slice()\n      .reverse()\n      .find((key) => key.startsWith(\"#\"))\n    onImportsSubpath({\n      key: firstBareKey,\n      value: subpathValue,\n      trace: subpathValueTrace,\n    })\n    return true\n  }\n\n  const handleObject = (subpathValue, subpathValueTrace) => {\n    // From Node.js documentation:\n    // \"If a nested conditional does not have any mapping it will continue\n    // checking the remaining conditions of the parent condition\"\n    // https://nodejs.org/docs/latest-v14.x/api/packages.html#packages_nested_conditions\n    //\n    // So it seems what we do here is not sufficient\n    // -> if the condition finally does not lead to something\n    // it should be ignored and an other branch be taken until\n    // something resolves\n    const followConditionBranch = (subpathValue, conditionTrace) => {\n      const bareKeys = []\n      const conditionalKeys = []\n      Object.keys(subpathValue).forEach((availableKey) => {\n        if (availableKey.startsWith(\"#\")) {\n          bareKeys.push(availableKey)\n        } else {\n          conditionalKeys.push(availableKey)\n        }\n      })\n\n      if (bareKeys.length > 0 && conditionalKeys.length > 0) {\n        warn(\n          createSubpathKeysAreMixedWarning({\n            subpathValue,\n            subpathValueTrace: [...subpathValueTrace, ...conditionTrace],\n            packageInfo,\n            bareKeys,\n            conditionalKeys,\n          }),\n        )\n        return false\n      }\n\n      // there is no condition, visit all bare keys (starting with #)\n      if (conditionalKeys.length === 0) {\n        let leadsToSomething = false\n        bareKeys.forEach((key) => {\n          leadsToSomething = visitSubpathValue(subpathValue[key], [\n            ...subpathValueTrace,\n            ...conditionTrace,\n            key,\n          ])\n        })\n        return leadsToSomething\n      }\n\n      // there is a condition, keep the first one leading to something\n      return conditionalKeys.some((keyCandidate) => {\n        if (!packageConditions.includes(keyCandidate)) {\n          return false\n        }\n        const valueCandidate = subpathValue[keyCandidate]\n        return visitSubpathValue(valueCandidate, [\n          ...subpathValueTrace,\n          ...conditionTrace,\n          keyCandidate,\n        ])\n      })\n    }\n\n    return followConditionBranch(subpathValue, [])\n  }\n\n  const handleRemaining = (subpathValue, subpathValueTrace) => {\n    warn(\n      createSubpathIsUnexpectedWarning({\n        subpathValue,\n        subpathValueTrace,\n        packageInfo,\n      }),\n    )\n    return false\n  }\n\n  visitSubpathValue(packageImports, [\"imports\"])\n\n  return importsSubpaths\n}\n\nconst createSubpathIsUnexpectedWarning = ({\n  subpathValue,\n  subpathValueTrace,\n  packageInfo,\n}) => {\n  return {\n    code: \"IMPORTS_SUBPATH_UNEXPECTED\",\n    message: `unexpected subpath in package.json imports: value must be an object or a string.\n--- value ---\n${subpathValue}\n--- value at ---\n${subpathValueTrace.join(\".\")}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo.url)}`,\n  }\n}\n\nconst createSubpathKeysAreMixedWarning = ({\n  subpathValue,\n  subpathValueTrace,\n  packageInfo,\n}) => {\n  return {\n    code: \"IMPORTS_SUBPATH_MIXED_KEYS\",\n    message: `unexpected subpath keys in package.json imports: cannot mix bare and conditional keys.\n--- value ---\n${JSON.stringify(subpathValue, null, \"  \")}\n--- value at ---\n${subpathValueTrace.join(\".\")}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo.url)}`,\n  }\n}\n\nconst createSubpathValueMustBeRelativeWarning = ({\n  value,\n  valueTrace,\n  packageInfo,\n}) => {\n  return {\n    code: \"IMPORTS_SUBPATH_VALUE_UNEXPECTED\",\n    message: `unexpected subpath value in package.json imports: value must be relative to package\n--- value ---\n${value}\n--- value at ---\n${valueTrace.join(\".\")}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo.url)}`,\n  }\n}\n",
    "/*\n\nhttps://nodejs.org/docs/latest-v15.x/api/packages.html#packages_node_js_package_json_field_definitions\n\n*/\n\nimport {\n  urlToFileSystemPath,\n  urlToRelativeUrl,\n  resolveUrl,\n} from \"@jsenv/filesystem\"\nimport { specifierIsRelative } from \"./specifierIsRelative.js\"\n\nexport const visitPackageExports = ({\n  projectDirectoryUrl,\n  warn,\n  packageInfo,\n  packageExports = packageInfo.object.exports,\n  packageName = packageInfo.name,\n  packageConditions,\n}) => {\n  const exportsSubpaths = {}\n  const packageDirectoryUrl = resolveUrl(\"./\", packageInfo.url)\n  const packageDirectoryRelativeUrl = urlToRelativeUrl(\n    packageDirectoryUrl,\n    projectDirectoryUrl,\n  )\n  const onExportsSubpath = ({ key, value, trace }) => {\n    if (!specifierIsRelative(value)) {\n      warn(\n        createSubpathValueMustBeRelativeWarning({\n          value,\n          valueTrace: trace,\n          packageInfo,\n        }),\n      )\n      return\n    }\n\n    const keyNormalized = specifierToSource(key, packageName)\n    const valueNormalized = addressToDestination(\n      value,\n      packageDirectoryRelativeUrl,\n    )\n    exportsSubpaths[keyNormalized] = valueNormalized\n  }\n\n  const visitSubpathValue = (subpathValue, subpathValueTrace) => {\n    // false is allowed as alternative to exports: {}\n    if (subpathValue === false) {\n      return handleFalse()\n    }\n\n    if (typeof subpathValue === \"string\") {\n      return handleString(subpathValue, subpathValueTrace)\n    }\n\n    if (typeof subpathValue === \"object\" && subpathValue !== null) {\n      return handleObject(subpathValue, subpathValueTrace)\n    }\n\n    return handleRemaining(subpathValue, subpathValueTrace)\n  }\n\n  const handleFalse = () => {\n    // nothing to do\n    return true\n  }\n\n  const handleString = (subpathValue, subpathValueTrace) => {\n    const firstRelativeKey = subpathValueTrace\n      .slice()\n      .reverse()\n      .find((key) => key.startsWith(\".\"))\n    const key = firstRelativeKey || \".\"\n    onExportsSubpath({\n      key,\n      value: subpathValue,\n      trace: subpathValueTrace,\n    })\n    return true\n  }\n\n  const handleObject = (subpathValue, subpathValueTrace) => {\n    // From Node.js documentation:\n    // \"If a nested conditional does not have any mapping it will continue\n    // checking the remaining conditions of the parent condition\"\n    // https://nodejs.org/docs/latest-v14.x/api/packages.html#packages_nested_conditions\n    //\n    // So it seems what we do here is not sufficient\n    // -> if the condition finally does not lead to something\n    // it should be ignored and an other branch be taken until\n    // something resolves\n    const followConditionBranch = (subpathValue, conditionTrace) => {\n      const relativeKeys = []\n      const conditionalKeys = []\n      Object.keys(subpathValue).forEach((availableKey) => {\n        if (availableKey.startsWith(\".\")) {\n          relativeKeys.push(availableKey)\n        } else {\n          conditionalKeys.push(availableKey)\n        }\n      })\n\n      if (relativeKeys.length > 0 && conditionalKeys.length > 0) {\n        warn(\n          createSubpathKeysAreMixedWarning({\n            subpathValue,\n            subpathValueTrace: [...subpathValueTrace, ...conditionTrace],\n            packageInfo,\n            relativeKeys,\n            conditionalKeys,\n          }),\n        )\n        return false\n      }\n\n      // there is no condition, visit all relative keys\n      if (conditionalKeys.length === 0) {\n        let leadsToSomething = false\n        relativeKeys.forEach((key) => {\n          leadsToSomething = visitSubpathValue(subpathValue[key], [\n            ...subpathValueTrace,\n            ...conditionTrace,\n            key,\n          ])\n        })\n        return leadsToSomething\n      }\n\n      // there is a condition, keep the first one leading to something\n      return conditionalKeys.some((keyCandidate) => {\n        if (!packageConditions.includes(keyCandidate)) {\n          return false\n        }\n        const valueCandidate = subpathValue[keyCandidate]\n        return visitSubpathValue(valueCandidate, [\n          ...subpathValueTrace,\n          ...conditionTrace,\n          keyCandidate,\n        ])\n      })\n    }\n\n    if (Array.isArray(subpathValue)) {\n      subpathValue = exportsObjectFromExportsArray(subpathValue)\n    }\n    return followConditionBranch(subpathValue, [])\n  }\n\n  const handleRemaining = (subpathValue, subpathValueTrace) => {\n    warn(\n      createSubpathIsUnexpectedWarning({\n        subpathValue,\n        subpathValueTrace,\n        packageInfo,\n      }),\n    )\n    return false\n  }\n\n  visitSubpathValue(packageExports, [\"exports\"])\n\n  return exportsSubpaths\n}\n\nconst exportsObjectFromExportsArray = (exportsArray) => {\n  const exportsObject = {}\n\n  exportsArray.forEach((exportValue) => {\n    if (typeof exportValue === \"object\") {\n      Object.assign(exportsObject, exportValue)\n      return\n    }\n    if (typeof exportValue === \"string\") {\n      exportsObject.default = exportValue\n    }\n  })\n\n  return exportsObject\n}\n\nconst specifierToSource = (specifier, packageName) => {\n  if (specifier === \".\") {\n    return packageName\n  }\n\n  if (specifier[0] === \"/\") {\n    return specifier\n  }\n\n  if (specifier.startsWith(\"./\")) {\n    return `${packageName}${specifier.slice(1)}`\n  }\n\n  return `${packageName}/${specifier}`\n}\n\nconst addressToDestination = (address, packageDirectoryRelativeUrl) => {\n  if (address[0] === \"/\") {\n    return address\n  }\n\n  if (address.startsWith(\"./\")) {\n    return `./${packageDirectoryRelativeUrl}${address.slice(2)}`\n  }\n\n  return `./${packageDirectoryRelativeUrl}${address}`\n}\n\nconst createSubpathIsUnexpectedWarning = ({\n  subpathValue,\n  subpathValueTrace,\n  packageInfo,\n}) => {\n  return {\n    code: \"EXPORTS_SUBPATH_UNEXPECTED\",\n    message: `unexpected subpath in package.json exports: value must be an object or a string.\n--- value ---\n${subpathValue}\n--- value at ---\n${subpathValueTrace.join(\".\")}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo)}`,\n  }\n}\n\nconst createSubpathKeysAreMixedWarning = ({\n  subpathValue,\n  subpathValueTrace,\n  packageInfo,\n}) => {\n  return {\n    code: \"EXPORTS_SUBPATH_MIXED_KEYS\",\n    message: `unexpected subpath keys in package.json exports: cannot mix relative and conditional keys.\n--- value ---\n${JSON.stringify(subpathValue, null, \"  \")}\n--- value at ---\n${subpathValueTrace.join(\".\")}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo)}`,\n  }\n}\n\nconst createSubpathValueMustBeRelativeWarning = ({\n  value,\n  valueTrace,\n  packageInfo,\n}) => {\n  return {\n    code: \"EXPORTS_SUBPATH_VALUE_MUST_BE_RELATIVE\",\n    message: `unexpected subpath value in package.json exports: value must be a relative to the package.\n--- value ---\n${value}\n--- value at ---\n${valueTrace.join(\".\")}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo)}`,\n  }\n}\n",
    "export const memoizeAsyncFunctionByUrl = (fn) => {\n  const cache = {}\n  return memoizeAsyncFunction(fn, {\n    getMemoryEntryFromArguments: ([url]) => {\n      return {\n        get: () => {\n          return cache[url]\n        },\n        set: (promise) => {\n          cache[url] = promise\n        },\n        delete: () => {\n          delete cache[url]\n        },\n      }\n    },\n  })\n}\n\nexport const memoizeAsyncFunctionBySpecifierAndImporter = (fn) => {\n  const importerCache = {}\n  return memoizeAsyncFunction(fn, {\n    getMemoryEntryFromArguments: ([specifier, importer]) => {\n      return {\n        get: () => {\n          const specifierCacheForImporter = importerCache[importer]\n          return specifierCacheForImporter\n            ? specifierCacheForImporter[specifier]\n            : null\n        },\n        set: (promise) => {\n          const specifierCacheForImporter = importerCache[importer]\n          if (specifierCacheForImporter) {\n            specifierCacheForImporter[specifier] = promise\n          } else {\n            importerCache[importer] = {\n              [specifier]: promise,\n            }\n          }\n        },\n        delete: () => {\n          const specifierCacheForImporter = importerCache[importer]\n          if (specifierCacheForImporter) {\n            delete specifierCacheForImporter[specifier]\n          }\n        },\n      }\n    },\n  })\n}\n\nconst memoizeAsyncFunction = (fn, { getMemoryEntryFromArguments }) => {\n  const memoized = async (...args) => {\n    const memoryEntry = getMemoryEntryFromArguments(args)\n    const promiseFromMemory = memoryEntry.get()\n    if (promiseFromMemory) {\n      return promiseFromMemory\n    }\n    const { promise, resolve, reject } = createControllablePromise()\n    memoryEntry.set(promise)\n    let value\n    let error\n    try {\n      value = fn(...args)\n      error = false\n    } catch (e) {\n      value = e\n      error = true\n      memoryEntry.delete()\n    }\n    if (error) {\n      reject(error)\n    } else {\n      resolve(value)\n    }\n    return promise\n  }\n  memoized.isInMemory = (...args) => {\n    return Boolean(getMemoryEntryFromArguments(args).get())\n  }\n  return memoized\n}\n\nconst createControllablePromise = () => {\n  let resolve\n  let reject\n  const promise = new Promise((res, rej) => {\n    resolve = res\n    reject = rej\n  })\n  return { promise, resolve, reject }\n}\n",
    "import { readFile, urlToFileSystemPath } from \"@jsenv/filesystem\"\n\nexport const PACKAGE_NOT_FOUND = {}\nexport const PACKAGE_WITH_SYNTAX_ERROR = {}\n\nexport const readPackageFile = async (packageFileUrl) => {\n  try {\n    const packageObject = await readFile(packageFileUrl, { as: \"json\" })\n    return packageObject\n  } catch (e) {\n    if (e.code === \"ENOENT\") {\n      return PACKAGE_NOT_FOUND\n    }\n\n    if (e.name === \"SyntaxError\") {\n      console.error(\n        formatPackageSyntaxErrorLog({ syntaxError: e, packageFileUrl }),\n      )\n      return PACKAGE_WITH_SYNTAX_ERROR\n    }\n\n    throw e\n  }\n}\n\nconst formatPackageSyntaxErrorLog = ({ syntaxError, packageFileUrl }) => {\n  return `\nerror while parsing package.json.\n--- syntax error message ---\n${syntaxError.message}\n--- package.json path ---\n${urlToFileSystemPath(packageFileUrl)}\n`\n}\n",
    "export const applyPackageManualOverride = (\n  packageObject,\n  packagesManualOverrides,\n) => {\n  const { name, version } = packageObject\n  const overrideKey = Object.keys(packagesManualOverrides).find(\n    (overrideKeyCandidate) => {\n      if (name === overrideKeyCandidate) {\n        return true\n      }\n      if (`${name}@${version}` === overrideKeyCandidate) {\n        return true\n      }\n      return false\n    },\n  )\n  if (overrideKey) {\n    return composeObject(packageObject, packagesManualOverrides[overrideKey])\n  }\n  return packageObject\n}\n\nconst composeObject = (leftObject, rightObject) => {\n  const composedObject = {\n    ...leftObject,\n  }\n  Object.keys(rightObject).forEach((key) => {\n    const rightValue = rightObject[key]\n\n    if (\n      rightValue === null ||\n      typeof rightValue !== \"object\" ||\n      key in leftObject === false\n    ) {\n      composedObject[key] = rightValue\n    } else {\n      const leftValue = leftObject[key]\n      if (leftValue === null || typeof leftValue !== \"object\") {\n        composedObject[key] = rightValue\n      } else {\n        composedObject[key] = composeObject(leftValue, rightValue)\n      }\n    }\n  })\n  return composedObject\n}\n",
    "import { firstOperationMatching } from \"@jsenv/cancellation\"\nimport { urlToRelativeUrl, resolveUrl } from \"@jsenv/filesystem\"\n\nimport { memoizeAsyncFunctionByUrl } from \"../memoizeAsyncFunction.js\"\nimport {\n  readPackageFile,\n  PACKAGE_NOT_FOUND,\n  PACKAGE_WITH_SYNTAX_ERROR,\n} from \"./readPackageFile.js\"\nimport { applyPackageManualOverride } from \"./applyPackageManualOverride.js\"\n\nexport const createFindNodeModulePackage = () => {\n  const readPackageFileMemoized = memoizeAsyncFunctionByUrl(\n    (packageFileUrl) => {\n      return readPackageFile(packageFileUrl)\n    },\n  )\n\n  return ({\n    projectDirectoryUrl,\n    packagesManualOverrides = {},\n    packageFileUrl,\n    dependencyName,\n  }) => {\n    const nodeModuleCandidates = getNodeModuleCandidates(\n      packageFileUrl,\n      projectDirectoryUrl,\n    )\n\n    return firstOperationMatching({\n      array: nodeModuleCandidates,\n      start: async (nodeModuleCandidate) => {\n        const packageFileUrlCandidate = `${projectDirectoryUrl}${nodeModuleCandidate}${dependencyName}/package.json`\n        const packageObjectCandidate = await readPackageFileMemoized(\n          packageFileUrlCandidate,\n        )\n\n        return {\n          packageFileUrl: packageFileUrlCandidate,\n          packageJsonObject: applyPackageManualOverride(\n            packageObjectCandidate,\n            packagesManualOverrides,\n          ),\n          syntaxError: packageObjectCandidate === PACKAGE_WITH_SYNTAX_ERROR,\n        }\n      },\n      predicate: ({ packageJsonObject }) => {\n        return packageJsonObject !== PACKAGE_NOT_FOUND\n      },\n    })\n  }\n}\n\nconst getNodeModuleCandidates = (fileUrl, projectDirectoryUrl) => {\n  const fileDirectoryUrl = resolveUrl(\"./\", fileUrl)\n\n  if (fileDirectoryUrl === projectDirectoryUrl) {\n    return [`node_modules/`]\n  }\n\n  const fileDirectoryRelativeUrl = urlToRelativeUrl(\n    fileDirectoryUrl,\n    projectDirectoryUrl,\n  )\n  const candidates = []\n  const relativeNodeModuleDirectoryArray =\n    fileDirectoryRelativeUrl.split(\"node_modules/\")\n  // remove the first empty string\n  relativeNodeModuleDirectoryArray.shift()\n\n  let i = relativeNodeModuleDirectoryArray.length\n  while (i--) {\n    candidates.push(\n      `node_modules/${relativeNodeModuleDirectoryArray\n        .slice(0, i + 1)\n        .join(\"node_modules/\")}node_modules/`,\n    )\n  }\n\n  return [...candidates, \"node_modules/\"]\n}\n",
    "import { createDetailedMessage } from \"@jsenv/logger\"\nimport {\n  resolveUrl,\n  readFile,\n  urlToRelativeUrl,\n  urlToFileSystemPath,\n} from \"@jsenv/filesystem\"\n\nimport { createPackageNameMustBeAStringWarning } from \"../logs.js\"\n\nimport { resolvePackageMain } from \"./resolvePackageMain.js\"\nimport { visitPackageImportMap } from \"./visitPackageImportMap.js\"\nimport { visitPackageImports } from \"./visitPackageImports.js\"\nimport { visitPackageExports } from \"./visitPackageExports.js\"\nimport { createFindNodeModulePackage } from \"./node-module-resolution.js\"\n\nexport const visitNodeModuleResolution = async ({\n  // nothing is actually listening for this cancellationToken for now\n  // it's not very important but it would be better to register on it\n  // an stops what we are doing if asked to do so\n  // cancellationToken = createCancellationTokenForProcess(),\n  logger,\n  warn,\n  projectDirectoryUrl,\n  visitors,\n  packagesManualOverrides,\n}) => {\n  const projectPackageFileUrl = resolveUrl(\n    \"./package.json\",\n    projectDirectoryUrl,\n  )\n  const findNodeModulePackage = createFindNodeModulePackage()\n\n  const seen = {}\n  const markPackageAsSeen = (packageFileUrl, importerPackageFileUrl) => {\n    if (packageFileUrl in seen) {\n      seen[packageFileUrl].push(importerPackageFileUrl)\n    } else {\n      seen[packageFileUrl] = [importerPackageFileUrl]\n    }\n  }\n  const packageIsSeen = (packageFileUrl, importerPackageFileUrl) => {\n    return (\n      packageFileUrl in seen &&\n      seen[packageFileUrl].includes(importerPackageFileUrl)\n    )\n  }\n\n  const visit = async ({\n    packageVisitors,\n    packageInfo,\n    packageImporterInfo,\n  }) => {\n    const packageName = packageInfo.object.name\n    if (typeof packageName !== \"string\") {\n      warn(\n        createPackageNameMustBeAStringWarning({\n          packageName,\n          packageInfo,\n        }),\n      )\n      // if package is root, we don't go further\n      // otherwise package name is deduced from file structure\n      // si it's thoerically safe to keep going\n      // in practice it should never happen because npm won't let\n      // a package without name be published\n      if (!packageImporterInfo) {\n        return\n      }\n    }\n\n    packageVisitors = packageVisitors.filter((visitor) => {\n      return (\n        !visitor.packageIncludedPredicate ||\n        visitor.packageIncludedPredicate(packageInfo, packageImporterInfo)\n      )\n    })\n    if (packageVisitors.length === 0) {\n      return\n    }\n\n    await visitDependencies({\n      packageVisitors,\n      packageInfo,\n    })\n\n    await visitPackage({\n      packageVisitors,\n      packageInfo,\n      packageImporterInfo,\n    })\n  }\n\n  const visitDependencies = async ({ packageVisitors, packageInfo }) => {\n    const dependencyMap = packageDependenciesFromPackageObject(\n      packageInfo.object,\n    )\n\n    await Promise.all(\n      Object.keys(dependencyMap).map(async (dependencyName) => {\n        const dependencyInfo = dependencyMap[dependencyName]\n        if (dependencyInfo.type === \"devDependency\") {\n          if (packageInfo.url !== projectPackageFileUrl) {\n            return\n          }\n          const visitorsForDevDependencies = packageVisitors.filter(\n            (visitor) => {\n              return visitor.mappingsForDevDependencies\n            },\n          )\n          if (visitorsForDevDependencies.length === 0) {\n            return\n          }\n\n          await visitDependency({\n            packageVisitors: visitorsForDevDependencies,\n            packageInfo,\n            dependencyName,\n            dependencyInfo,\n          })\n          return\n        }\n\n        await visitDependency({\n          packageVisitors,\n          packageInfo,\n          dependencyName,\n          dependencyInfo,\n        })\n      }),\n    )\n  }\n\n  const visitDependency = async ({\n    packageVisitors,\n    packageInfo,\n    dependencyName,\n    dependencyInfo,\n  }) => {\n    const dependencyData = await findDependency({\n      packageFileUrl: packageInfo.url,\n      dependencyName,\n    })\n    if (!dependencyData) {\n      const cannotFindPackageWarning = createCannotFindPackageWarning({\n        dependencyName,\n        dependencyInfo,\n        packageInfo,\n      })\n      if (dependencyInfo.isOptional) {\n        logger.debug(cannotFindPackageWarning.message)\n      } else {\n        warn(cannotFindPackageWarning)\n      }\n      return\n    }\n    if (dependencyData.syntaxError) {\n      return\n    }\n\n    const {\n      packageFileUrl: dependencyPackageFileUrl,\n      packageJsonObject: dependencyPackageJsonObject,\n    } = dependencyData\n\n    if (packageIsSeen(dependencyPackageFileUrl, packageInfo.url)) {\n      return\n    }\n    markPackageAsSeen(dependencyPackageFileUrl, packageInfo.url)\n    await visit({\n      packageVisitors,\n      packageInfo: {\n        url: dependencyPackageFileUrl,\n        name: dependencyName,\n        object: dependencyPackageJsonObject,\n      },\n      packageImporterInfo: packageInfo,\n    })\n  }\n\n  const visitPackage = async ({\n    packageVisitors,\n    packageInfo,\n    packageImporterInfo,\n  }) => {\n    const packageDerivedInfo = computePackageDerivedInfo({\n      projectDirectoryUrl,\n      packageInfo,\n      packageImporterInfo,\n    })\n\n    const addImportMapForPackage = (visitor, importMap) => {\n      if (packageDerivedInfo.packageIsRoot) {\n        const { imports = {}, scopes = {} } = importMap\n        Object.keys(imports).forEach((from) => {\n          triggerVisitorOnMapping(visitor, {\n            from,\n            to: imports[from],\n          })\n        })\n        Object.keys(scopes).forEach((scope) => {\n          const scopeMappings = scopes[scope]\n          Object.keys(scopeMappings).forEach((key) => {\n            triggerVisitorOnMapping(visitor, {\n              scope,\n              from: key,\n              to: scopeMappings[key],\n            })\n          })\n        })\n        return\n      }\n\n      const { imports = {}, scopes = {} } = importMap\n      const scope = `./${packageDerivedInfo.packageDirectoryRelativeUrl}`\n      Object.keys(imports).forEach((from) => {\n        const to = imports[from]\n        const toMoved = moveMappingValue(\n          to,\n          packageInfo.url,\n          projectDirectoryUrl,\n        )\n        triggerVisitorOnMapping(visitor, {\n          scope,\n          from,\n          to: toMoved,\n        })\n      })\n      Object.keys(scopes).forEach((scope) => {\n        const scopeMappings = scopes[scope]\n        const scopeMoved = moveMappingValue(\n          scope,\n          packageInfo.url,\n          projectDirectoryUrl,\n        )\n        Object.keys(scopeMappings).forEach((key) => {\n          const to = scopeMappings[key]\n          const toMoved = moveMappingValue(\n            to,\n            packageInfo.url,\n            projectDirectoryUrl,\n          )\n          triggerVisitorOnMapping(visitor, {\n            scope: scopeMoved,\n            from: key,\n            to: toMoved,\n          })\n        })\n      })\n    }\n\n    const addMappingsForPackageAndImporter = (visitor, mappings) => {\n      if (packageDerivedInfo.packageIsRoot) {\n        Object.keys(mappings).forEach((from) => {\n          const to = mappings[from]\n          triggerVisitorOnMapping(visitor, {\n            from,\n            to,\n          })\n        })\n        return\n      }\n\n      if (packageDerivedInfo.importerIsRoot) {\n        // own package mappings available to himself\n        Object.keys(mappings).forEach((from) => {\n          const to = mappings[from]\n          triggerVisitorOnMapping(visitor, {\n            scope: `./${packageDerivedInfo.packageDirectoryRelativeUrl}`,\n            from,\n            to,\n          })\n          triggerVisitorOnMapping(visitor, { from, to })\n        })\n\n        // if importer is root no need to make package mappings available to the importer\n        // because they are already on top level mappings\n        return\n      }\n\n      Object.keys(mappings).forEach((from) => {\n        const to = mappings[from]\n        // own package exports available to himself\n        triggerVisitorOnMapping(visitor, {\n          scope: `./${packageDerivedInfo.packageDirectoryRelativeUrl}`,\n          from,\n          to,\n        })\n        // now make package exports available to the importer\n        // here if the importer is himself we could do stuff\n        // we should even handle the case earlier to prevent top level remapping\n        triggerVisitorOnMapping(visitor, {\n          scope: `./${packageDerivedInfo.importerRelativeUrl}`,\n          from,\n          to,\n        })\n      })\n    }\n\n    const importsFromPackageField = await visitPackageImportMap({\n      warn,\n      packageInfo,\n      projectDirectoryUrl,\n    })\n    packageVisitors.forEach((visitor) => {\n      addImportMapForPackage(visitor, importsFromPackageField)\n    })\n\n    if (\"imports\" in packageInfo.object) {\n      packageVisitors.forEach((visitor) => {\n        const packageImports = visitPackageImports({\n          warn,\n          packageInfo,\n          projectDirectoryUrl,\n          packageConditions: visitor.packageConditions,\n        })\n\n        const mappingsFromPackageImports = {}\n        Object.keys(packageImports).forEach((from) => {\n          const to = packageImports[from]\n          mappingsFromPackageImports[from] = to\n        })\n        addImportMapForPackage(visitor, {\n          imports: mappingsFromPackageImports,\n        })\n      })\n    }\n\n    if (\"exports\" in packageInfo.object) {\n      packageVisitors.forEach((visitor) => {\n        const packageExports = visitPackageExports({\n          projectDirectoryUrl,\n          warn,\n          packageInfo,\n          packageConditions: visitor.packageConditions,\n        })\n        const mappingsFromPackageExports = {}\n        Object.keys(packageExports).forEach((from) => {\n          const to = packageExports[from]\n          if (from.indexOf(\"*\") === -1) {\n            mappingsFromPackageExports[from] = to\n            return\n          }\n\n          if (\n            from.endsWith(\"/*\") &&\n            to.endsWith(\"/*\") &&\n            // ensure ends with '*' AND there is only one '*' occurence\n            to.indexOf(\"*\") === to.length - 1\n          ) {\n            const fromWithouTrailingStar = from.slice(0, -1)\n            const toWithoutTrailingStar = to.slice(0, -1)\n            mappingsFromPackageExports[fromWithouTrailingStar] =\n              toWithoutTrailingStar\n            return\n          }\n\n          logger.debug(\n            createExportsWildcardIgnoredWarning({\n              key: from,\n              value: to,\n              packageInfo,\n            }),\n          )\n        })\n        addMappingsForPackageAndImporter(visitor, mappingsFromPackageExports)\n      })\n    } else {\n      // no \"exports\" field means any file can be imported\n      // -> generate a mapping to allow this\n      // https://nodejs.org/docs/latest-v15.x/api/packages.html#packages_name\n      const packageDirectoryRelativeUrl = urlToRelativeUrl(\n        resolveUrl(\"./\", packageInfo.url),\n        projectDirectoryUrl,\n      )\n      packageVisitors.forEach((visitor) => {\n        addMappingsForPackageAndImporter(visitor, {\n          [`${packageInfo.name}/`]: `./${packageDirectoryRelativeUrl}`,\n        })\n      })\n\n      // visit \"main\" only if there is no \"exports\"\n      // https://nodejs.org/docs/latest-v16.x/api/packages.html#packages_main\n      await visitPackageMain({\n        packageVisitors,\n        packageInfo,\n        packageDerivedInfo,\n      })\n    }\n  }\n\n  const visitPackageMain = async ({\n    packageVisitors,\n    packageInfo,\n    packageDerivedInfo,\n  }) => {\n    const {\n      packageIsRoot,\n      importerIsRoot,\n      importerRelativeUrl,\n      packageDirectoryUrl,\n      packageDirectoryUrlExpected,\n    } = packageDerivedInfo\n\n    await packageVisitors.reduce(async (previous, visitor) => {\n      await previous\n      const mainFileUrl = await resolvePackageMain({\n        warn,\n        packageInfo,\n        nodeResolutionConditions: visitor.nodeResolutionConditions,\n      })\n\n      // it's possible to have no main\n      // like { main: \"\" } in package.json\n      // or a main that does not lead to an actual file\n      if (mainFileUrl === null) {\n        return\n      }\n\n      const mainFileRelativeUrl = urlToRelativeUrl(\n        mainFileUrl,\n        projectDirectoryUrl,\n      )\n      const scope =\n        packageIsRoot || importerIsRoot ? null : `./${importerRelativeUrl}`\n      const from = packageInfo.name\n      const to = `./${mainFileRelativeUrl}`\n\n      triggerVisitorOnMapping(visitor, {\n        scope,\n        from,\n        to,\n      })\n\n      if (packageDirectoryUrl !== packageDirectoryUrlExpected) {\n        triggerVisitorOnMapping(visitor, {\n          scope: `./${importerRelativeUrl}`,\n          from,\n          to,\n        })\n      }\n    }, Promise.resolve())\n  }\n\n  const dependenciesCache = {}\n  const findDependency = ({ packageFileUrl, dependencyName }) => {\n    if (packageFileUrl in dependenciesCache === false) {\n      dependenciesCache[packageFileUrl] = {}\n    }\n    if (dependencyName in dependenciesCache[packageFileUrl]) {\n      return dependenciesCache[packageFileUrl][dependencyName]\n    }\n    const dependencyPromise = findNodeModulePackage({\n      projectDirectoryUrl,\n      packageFileUrl,\n      dependencyName,\n      packagesManualOverrides,\n    })\n    dependenciesCache[packageFileUrl][dependencyName] = dependencyPromise\n    return dependencyPromise\n  }\n\n  let projectPackageObject\n  try {\n    projectPackageObject = await readFile(projectPackageFileUrl, { as: \"json\" })\n  } catch (e) {\n    if (e.code === \"ENOENT\") {\n      const error = new Error(\n        createDetailedMessage(`Cannot find project package.json file.`, {\n          \"package.json url\": projectPackageFileUrl,\n        }),\n      )\n      error.code = \"PROJECT_PACKAGE_FILE_NOT_FOUND\"\n      throw error\n    }\n    throw e\n  }\n\n  const importerPackageFileUrl = projectPackageFileUrl\n  markPackageAsSeen(projectPackageFileUrl, importerPackageFileUrl)\n  await visit({\n    packageInfo: {\n      url: projectPackageFileUrl,\n      name: projectPackageObject.name,\n      object: projectPackageObject,\n    },\n    packageImporterInfo: null,\n    packageVisitors: visitors,\n  })\n}\n\nconst triggerVisitorOnMapping = (visitor, { scope, from, to }) => {\n  if (scope) {\n    // when a package says './' maps to './'\n    // we add something to say if we are already inside the package\n    // no need to ensure leading slash are scoped to the package\n    if (from === \"./\" && to === scope) {\n      triggerVisitorOnMapping(visitor, {\n        scope,\n        from: scope,\n        to: scope,\n      })\n      const packageName = scope.slice(\n        scope.lastIndexOf(\"node_modules/\") + `node_modules/`.length,\n      )\n      triggerVisitorOnMapping(visitor, {\n        scope,\n        from: packageName,\n        to: scope,\n      })\n    }\n\n    visitor.onMapping({\n      scope,\n      from,\n      to,\n    })\n    return\n  }\n\n  // we could think it's useless to remap from with to\n  // however it can be used to ensure a weaker remapping\n  // does not win over this specific file or folder\n  if (from === to) {\n    /**\n     * however remapping '/' to '/' is truly useless\n     * moreover it would make wrapImportMap create something like\n     * {\n     *   imports: {\n     *     \"/\": \"/.dist/best/\"\n     *   }\n     * }\n     * that would append the wrapped folder twice\n     * */\n    if (from === \"/\") return\n  }\n  visitor.onMapping({ from, to })\n}\n\nconst packageDependenciesFromPackageObject = (packageObject) => {\n  const packageDependencies = {}\n\n  const { dependencies = {} } = packageObject\n  // https://npm.github.io/using-pkgs-docs/package-json/types/optionaldependencies.html\n  const { optionalDependencies = {} } = packageObject\n  Object.keys(dependencies).forEach((dependencyName) => {\n    packageDependencies[dependencyName] = {\n      type: \"dependency\",\n      isOptional: dependencyName in optionalDependencies,\n      versionPattern: dependencies[dependencyName],\n    }\n  })\n\n  const { peerDependencies = {} } = packageObject\n  const { peerDependenciesMeta = {} } = packageObject\n  Object.keys(peerDependencies).forEach((dependencyName) => {\n    packageDependencies[dependencyName] = {\n      type: \"peerDependency\",\n      versionPattern: peerDependencies[dependencyName],\n      isOptional:\n        dependencyName in peerDependenciesMeta &&\n        peerDependenciesMeta[dependencyName].optional,\n    }\n  })\n\n  const { devDependencies = {} } = packageObject\n  Object.keys(devDependencies).forEach((dependencyName) => {\n    if (!packageDependencies.hasOwnProperty(dependencyName)) {\n      packageDependencies[dependencyName] = {\n        type: \"devDependency\",\n        versionPattern: devDependencies[dependencyName],\n      }\n    }\n  })\n\n  return packageDependencies\n}\n\nconst moveMappingValue = (address, from, to) => {\n  const url = resolveUrl(address, from)\n  const relativeUrl = urlToRelativeUrl(url, to)\n  if (relativeUrl.startsWith(\"../\")) {\n    return relativeUrl\n  }\n  if (relativeUrl.startsWith(\"./\")) {\n    return relativeUrl\n  }\n  if (/^[a-zA-Z]{2,}:/.test(relativeUrl)) {\n    // has sheme\n    return relativeUrl\n  }\n  return `./${relativeUrl}`\n}\n\nconst computePackageDerivedInfo = ({\n  projectDirectoryUrl,\n  packageInfo,\n  packageImporterInfo,\n}) => {\n  if (!packageImporterInfo) {\n    const packageDirectoryUrl = resolveUrl(\"./\", packageInfo.url)\n    urlToRelativeUrl(packageDirectoryUrl, projectDirectoryUrl)\n\n    return {\n      importerIsRoot: false,\n      importerRelativeUrl: \"\",\n      packageIsRoot: true,\n      packageDirectoryUrl,\n      packageDirectoryUrlExpected: packageDirectoryUrl,\n      packageDirectoryRelativeUrl: urlToRelativeUrl(\n        packageDirectoryUrl,\n        projectDirectoryUrl,\n      ),\n    }\n  }\n\n  const projectPackageFileUrl = resolveUrl(\n    \"./package.json\",\n    projectDirectoryUrl,\n  )\n\n  const importerIsRoot = packageImporterInfo.url === projectPackageFileUrl\n\n  const importerPackageDirectoryUrl = resolveUrl(\"./\", packageImporterInfo.url)\n\n  const importerRelativeUrl = urlToRelativeUrl(\n    importerPackageDirectoryUrl,\n    projectDirectoryUrl,\n  )\n\n  const packageIsRoot = packageInfo.url === projectPackageFileUrl\n\n  const packageDirectoryUrl = resolveUrl(\"./\", packageInfo.url)\n\n  const packageDirectoryUrlExpected = `${importerPackageDirectoryUrl}node_modules/${packageInfo.name}/`\n\n  const packageDirectoryRelativeUrl = urlToRelativeUrl(\n    packageDirectoryUrl,\n    projectDirectoryUrl,\n  )\n\n  return {\n    importerIsRoot,\n    importerRelativeUrl,\n    packageIsRoot,\n    packageDirectoryUrl,\n    packageDirectoryUrlExpected,\n    packageDirectoryRelativeUrl,\n  }\n}\n\nconst createExportsWildcardIgnoredWarning = ({ key, value, packageInfo }) => {\n  return {\n    code: \"EXPORTS_WILDCARD\",\n    message: `Ignoring export using \"*\" because it is not supported by importmap.\n--- key ---\n${key}\n--- value ---\n${value}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo.url)}\n--- see also ---\nhttps://github.com/WICG/import-maps/issues/232`,\n  }\n}\n\nconst createCannotFindPackageWarning = ({\n  dependencyName,\n  dependencyInfo,\n  packageInfo,\n}) => {\n  const dependencyIsOptional = dependencyInfo.isOptional\n  const dependencyType = dependencyInfo.type\n  const dependencyVersionPattern = dependencyInfo.versionPattern\n  return {\n    code: \"CANNOT_FIND_PACKAGE\",\n    message: createDetailedMessage(\n      dependencyIsOptional\n        ? `cannot find an optional ${dependencyType}.`\n        : `cannot find a ${dependencyType}.`,\n      {\n        [dependencyType]: `${dependencyName}@${dependencyVersionPattern}`,\n        \"required by\": urlToFileSystemPath(packageInfo.url),\n      },\n    ),\n  }\n}\n",
    "export const optimizeImportMap = ({ imports, scopes }) => {\n  // remove useless duplicates (scoped key+value already defined on imports)\n  const scopesOptimized = {}\n  Object.keys(scopes).forEach((scope) => {\n    const scopeMappings = scopes[scope]\n    const scopeMappingsOptimized = {}\n    Object.keys(scopeMappings).forEach((mappingKey) => {\n      const topLevelMappingValue = imports[mappingKey]\n      const mappingValue = scopeMappings[mappingKey]\n      if (!topLevelMappingValue || topLevelMappingValue !== mappingValue) {\n        scopeMappingsOptimized[mappingKey] = mappingValue\n      }\n    })\n    if (Object.keys(scopeMappingsOptimized).length > 0) {\n      scopesOptimized[scope] = scopeMappingsOptimized\n    }\n  })\n  return { imports, scopes: scopesOptimized }\n}\n",
    "/* global __filename */\n\nconst filenameContainsBackSlashes = __filename.indexOf(\"\\\\\") > -1\n\nconst url = filenameContainsBackSlashes\n  ? `file:///${__filename.replace(/\\\\/g, \"/\")}`\n  : `file://${__filename}`\n\nexport default url\n",
    "import { createRequire } from \"module\"\nimport {\n  readFile,\n  urlToFileSystemPath,\n  urlToExtension,\n} from \"@jsenv/filesystem\"\n\nconst require = createRequire(import.meta.url)\n\nconst parser = require(\"@babel/parser\")\nconst traverse = require(\"@babel/traverse\")\n\nexport const parseSpecifiersFromFile = async (\n  fileUrl,\n  { fileContent, jsFilesParsingOptions } = {},\n) => {\n  fileContent =\n    fileContent === undefined\n      ? await readFile(fileUrl, { as: \"string\" })\n      : fileContent\n\n  const fileExtension = urlToExtension(fileUrl)\n\n  const {\n    jsx = [\".jsx\", \".tsx\"].includes(fileExtension),\n    typescript = [\".ts\", \".tsx\"].includes(urlToExtension(fileUrl)),\n    flow = false,\n  } = jsFilesParsingOptions\n\n  const ast = parser.parse(fileContent, {\n    sourceType: \"module\",\n    sourceFilename: urlToFileSystemPath(fileUrl),\n    plugins: [\n      \"topLevelAwait\",\n      \"exportDefaultFrom\",\n      ...(jsx ? [\"jsx\"] : []),\n      ...(typescript ? [\"typescript\"] : []),\n      ...(flow ? [\"flow\"] : []),\n    ],\n    ...jsFilesParsingOptions,\n    ranges: true,\n  })\n\n  const specifiers = {}\n\n  const addSpecifier = ({ path, type }) => {\n    const specifier = path.node.value\n    specifiers[specifier] = {\n      line: path.node.loc.start.line,\n      column: path.node.loc.start.column,\n      type,\n    }\n  }\n\n  traverse.default(ast, {\n    // \"ImportExpression is replaced with a CallExpression whose callee is an Import node.\"\n    // https://babeljs.io/docs/en/babel-parser#output\n    // ImportExpression: (path) => {\n    //   if (path.node.arguments[0].type !== \"StringLiteral\") {\n    //     // Non-string argument, probably a variable or expression, e.g.\n    //     // import(moduleId)\n    //     // import('./' + moduleName)\n    //     return\n    //   }\n    //   addSpecifier(path.get(\"arguments\")[0])\n    // },\n    CallExpression: (path) => {\n      if (path.node.callee.type !== \"Import\") {\n        // Some other function call, not import();\n        return\n      }\n      if (path.node.arguments[0].type !== \"StringLiteral\") {\n        // Non-string argument, probably a variable or expression, e.g.\n        // import(moduleId)\n        // import('./' + moduleName)\n        return\n      }\n      addSpecifier({\n        path: path.get(\"arguments\")[0],\n        type: \"import-dynamic\",\n      })\n    },\n    ExportAllDeclaration: (path) => {\n      addSpecifier({\n        path: path.get(\"source\"),\n        type: \"export-all\",\n      })\n    },\n    ExportNamedDeclaration: (path) => {\n      if (!path.node.source) {\n        // This export has no \"source\", so it's probably\n        // a local variable or function, e.g.\n        // export { varName }\n        // export const constName = ...\n        // export function funcName() {}\n        return\n      }\n      addSpecifier({\n        path: path.get(\"source\"),\n        type: \"export-named\",\n      })\n    },\n    ImportDeclaration: (path) => {\n      addSpecifier({\n        path: path.get(\"source\"),\n        type: \"import-static\",\n      })\n    },\n  })\n\n  return specifiers\n}\n",
    "// https://github.com/postcss/postcss/blob/fd30d3df5abc0954a0ec642a3cdc644ab2aacf9c/lib/css-syntax-error.js#L43\n// https://github.com/postcss/postcss/blob/fd30d3df5abc0954a0ec642a3cdc644ab2aacf9c/lib/terminal-highlight.js#L50\n// https://github.com/babel/babel/blob/eea156b2cb8deecfcf82d52aa1b71ba4995c7d68/packages/babel-code-frame/src/index.js#L1\n\nexport const showSource = ({ url, line, column, source }) => {\n  let message = \"\"\n\n  message += typeof url === \"undefined\" ? \"Anonymous\" : url\n  if (typeof line !== \"number\") {\n    return message\n  }\n\n  message += `:${line}`\n  if (typeof column === \"number\") {\n    message += `:${column}`\n  }\n\n  if (!source) {\n    return message\n  }\n\n  return `${message}\n${showSourceLocation(source, {\n  line,\n  column,\n})}`\n}\n\nconst red = \"\\x1b[31m\"\nconst grey = \"\\x1b[39m\"\nconst ansiResetSequence = \"\\x1b[0m\"\n\nconst showSourceLocation = (\n  source,\n  {\n    line,\n    column,\n    numberOfSurroundingLinesToShow = 1,\n    lineMaxLength = 120,\n    color = false,\n    markColor = red,\n    asideColor = grey,\n    colorMark = (string) => `${markColor}${string}${ansiResetSequence}`,\n    colorAside = (string) => `${asideColor}${string}${ansiResetSequence}`,\n  },\n) => {\n  const mark = color ? colorMark : (string) => string\n  const aside = color ? colorAside : (string) => string\n\n  const lines = source.split(/\\r?\\n/)\n  let lineRange = {\n    start: line - 1,\n    end: line,\n  }\n  lineRange = moveLineRangeUp(lineRange, numberOfSurroundingLinesToShow)\n  lineRange = moveLineRangeDown(lineRange, numberOfSurroundingLinesToShow)\n  lineRange = lineRangeWithinLines(lineRange, lines)\n  const linesToShow = lines.slice(lineRange.start, lineRange.end)\n  const endLineNumber = lineRange.end\n  const lineNumberMaxWidth = String(endLineNumber).length\n\n  const columnRange = {}\n  if (column === undefined) {\n    columnRange.start = 0\n    columnRange.end = lineMaxLength\n  } else if (column > lineMaxLength) {\n    columnRange.start = column - Math.floor(lineMaxLength / 2)\n    columnRange.end = column + Math.ceil(lineMaxLength / 2)\n  } else {\n    columnRange.start = 0\n    columnRange.end = lineMaxLength\n  }\n\n  return linesToShow.map((lineSource, index) => {\n    const lineNumber = lineRange.start + index + 1\n    const isMainLine = lineNumber === line\n    const lineSourceTruncated = applyColumnRange(columnRange, lineSource)\n    const lineNumberWidth = String(lineNumber).length\n    // ensure if line moves from 7,8,9 to 10 the display is still great\n    const lineNumberRightSpacing = \" \".repeat(\n      lineNumberMaxWidth - lineNumberWidth,\n    )\n    const asideSource = `${lineNumber}${lineNumberRightSpacing} |`\n    const lineFormatted = `${aside(asideSource)} ${lineSourceTruncated}`\n    if (isMainLine) {\n      if (column === undefined) {\n        return `${mark(\">\")} ${lineFormatted}`\n      }\n      const lineSourceUntilColumn = lineSourceTruncated.slice(\n        0,\n        column - columnRange.start,\n      )\n      const spacing = stringToSpaces(lineSourceUntilColumn)\n      const mainLineFormatted = `${mark(\">\")} ${lineFormatted}\n  ${\" \".repeat(lineNumberWidth)} ${aside(\"|\")}${spacing}${mark(\"^\")}`\n      return mainLineFormatted\n    }\n    return `  ${lineFormatted}`\n  }).join(`\n`)\n}\n\nconst applyColumnRange = ({ start, end }, line) => {\n  if (typeof start !== \"number\") {\n    throw new TypeError(`start must be a number, received ${start}`)\n  }\n  if (typeof end !== \"number\") {\n    throw new TypeError(`end must be a number, received ${end}`)\n  }\n  if (end < start) {\n    throw new Error(\n      `end must be greater than start, but ${end} is smaller than ${start}`,\n    )\n  }\n\n  const prefix = \"…\"\n  const suffix = \"…\"\n  const lastIndex = line.length\n\n  if (line.length === 0) {\n    // don't show any ellipsis if the line is empty\n    // because it's not truncated in that case\n    return \"\"\n  }\n\n  const startTruncated = start > 0\n  const endTruncated = lastIndex > end\n\n  let from = startTruncated ? start + prefix.length : start\n  let to = endTruncated ? end - suffix.length : end\n  if (to > lastIndex) to = lastIndex\n\n  if (start >= lastIndex || from === to) {\n    return \"\"\n  }\n\n  let result = \"\"\n  while (from < to) {\n    result += line[from]\n    from++\n  }\n\n  if (result.length === 0) {\n    return \"\"\n  }\n  if (startTruncated && endTruncated) {\n    return `${prefix}${result}${suffix}`\n  }\n  if (startTruncated) {\n    return `${prefix}${result}`\n  }\n  if (endTruncated) {\n    return `${result}${suffix}`\n  }\n  return result\n}\n\nconst stringToSpaces = (string) => string.replace(/[^\\t]/g, \" \")\n\n// const getLineRangeLength = ({ start, end }) => end - start\n\nconst moveLineRangeUp = ({ start, end }, number) => {\n  return {\n    start: start - number,\n    end,\n  }\n}\n\nconst moveLineRangeDown = ({ start, end }, number) => {\n  return {\n    start,\n    end: end + number,\n  }\n}\n\nconst lineRangeWithinLines = ({ start, end }, lines) => {\n  return {\n    start: start < 0 ? 0 : start,\n    end: end > lines.length ? lines.length : end,\n  }\n}\n",
    "import {\n  resolveUrl,\n  readFile,\n  urlToExtension,\n  urlToRelativeUrl,\n} from \"@jsenv/filesystem\"\nimport {\n  normalizeImportMap,\n  resolveImport,\n  composeTwoImportMaps,\n} from \"@jsenv/importmap\"\nimport { isSpecifierForNodeCoreModule } from \"@jsenv/importmap/src/isSpecifierForNodeCoreModule.js\"\n\nimport {\n  memoizeAsyncFunctionByUrl,\n  memoizeAsyncFunctionBySpecifierAndImporter,\n} from \"../memoizeAsyncFunction.js\"\n\nimport { parseSpecifiersFromFile } from \"./parseSpecifiersFromFile.js\"\nimport { showSource } from \"./showSource.js\"\nimport { resolveFile } from \"../resolveFile.js\"\nimport {\n  createPackageNameMustBeAStringWarning,\n  createBareSpecifierAutomappingMessage,\n  createExtensionLessAutomappingMessage,\n  createImportResolutionFailedWarning,\n} from \"../logs.js\"\n\nconst BARE_SPECIFIER_ERROR = {}\n\nexport const visitSourceFiles = async ({\n  logger,\n  warn,\n  projectDirectoryUrl,\n  jsFilesParsingOptions = {},\n  runtime,\n  importMap,\n  bareSpecifierAutomapping,\n  extensionlessAutomapping,\n  magicExtensions, //  = [\".js\", \".jsx\", \".ts\", \".tsx\", \".node\", \".json\"],\n  removeUnusedMappings,\n}) => {\n  const projectPackageFileUrl = resolveUrl(\n    \"./package.json\",\n    projectDirectoryUrl,\n  )\n\n  const imports = {}\n  const scopes = {}\n  const addMapping = ({ scope, from, to }) => {\n    if (scope) {\n      scopes[scope] = {\n        ...(scopes[scope] || {}),\n        [from]: to,\n      }\n    } else {\n      imports[from] = to\n    }\n  }\n\n  const topLevelMappingsUsed = []\n  const scopedMappingsUsed = {}\n  const markMappingAsUsed = ({ scope, from, to }) => {\n    if (scope) {\n      if (scope in scopedMappingsUsed) {\n        scopedMappingsUsed[scope].push({ from, to })\n      } else {\n        scopedMappingsUsed[scope] = [{ from, to }]\n      }\n    } else {\n      topLevelMappingsUsed.push({ from, to })\n    }\n  }\n  const importMapNormalized = normalizeImportMap(importMap, projectDirectoryUrl)\n  const trackAndResolveImport = (specifier, importer) => {\n    return resolveImport({\n      specifier,\n      importer,\n      importMap: importMapNormalized,\n      defaultExtension: false,\n      onImportMapping: ({ scope, from }) => {\n        if (scope) {\n          // make scope relative again\n          scope = `./${urlToRelativeUrl(scope, projectDirectoryUrl)}`\n          // make from relative again\n          if (from.startsWith(projectDirectoryUrl)) {\n            from = `./${urlToRelativeUrl(from, projectDirectoryUrl)}`\n          }\n        }\n\n        markMappingAsUsed({\n          scope,\n          from,\n          to: scope ? importMap.scopes[scope][from] : importMap.imports[from],\n        })\n      },\n      createBareSpecifierError: () => BARE_SPECIFIER_ERROR,\n    })\n  }\n\n  const testImportResolution = memoizeAsyncFunctionBySpecifierAndImporter(\n    async (specifier, importer, { importedBy }) => {\n      const url = await tryToResolveImport({\n        logger,\n        warn,\n        specifier,\n        importer,\n        importedBy,\n        projectDirectoryUrl,\n        projectPackageFileUrl,\n        trackAndResolveImport,\n        runtime,\n        bareSpecifierAutomapping,\n        extensionlessAutomapping,\n        magicExtensions,\n        performAutomapping: (automapping) => {\n          addMapping(automapping)\n          markMappingAsUsed(automapping)\n        },\n      })\n\n      return url\n    },\n  )\n\n  const visitFile = memoizeAsyncFunctionByUrl(async (fileUrl) => {\n    const fileContent = await readFile(fileUrl, { as: \"string\" })\n    const specifiers = await parseSpecifiersFromFile(fileUrl, {\n      fileContent,\n      jsFilesParsingOptions,\n    })\n\n    const dependencies = await Promise.all(\n      Object.keys(specifiers).map(async (specifier) => {\n        const specifierInfo = specifiers[specifier]\n        const dependencyUrlOnFileSystem = await testImportResolution(\n          specifier,\n          fileUrl,\n          {\n            importedBy: showSource({\n              url: fileUrl,\n              line: specifierInfo.line,\n              column: specifierInfo.column,\n              source: fileContent,\n            }),\n          },\n        )\n        return dependencyUrlOnFileSystem\n      }),\n    )\n    const dependenciesToVisit = dependencies.filter((dependency) => {\n      return dependency && !visitFile.isInMemory(dependency)\n    })\n    await Promise.all(\n      dependenciesToVisit.map((dependency) => {\n        return visitFile(dependency)\n      }),\n    )\n  })\n\n  const projectPackageObject = await readFile(projectPackageFileUrl, {\n    as: \"json\",\n  })\n  const projectPackageName = projectPackageObject.name\n  if (typeof projectPackageName !== \"string\") {\n    warn(\n      createPackageNameMustBeAStringWarning({\n        packageName: projectPackageName,\n        packageFileUrl: projectPackageFileUrl,\n      }),\n    )\n    return importMap\n  }\n\n  const projectMainFileUrlOnFileSystem = await testImportResolution(\n    projectPackageName,\n    projectPackageFileUrl,\n    {\n      importedBy: projectPackageObject.exports\n        ? `${projectPackageFileUrl}#exports`\n        : `${projectPackageFileUrl}`,\n    },\n  )\n  if (projectMainFileUrlOnFileSystem) {\n    await visitFile(projectMainFileUrlOnFileSystem)\n  }\n\n  if (removeUnusedMappings) {\n    const importsUsed = {}\n    topLevelMappingsUsed.forEach(({ from, to }) => {\n      importsUsed[from] = to\n    })\n    const scopesUsed = {}\n    Object.keys(scopedMappingsUsed).forEach((scope) => {\n      const mappingsUsed = scopedMappingsUsed[scope]\n      const scopedMappings = {}\n      mappingsUsed.forEach(({ from, to }) => {\n        scopedMappings[from] = to\n      })\n      scopesUsed[scope] = scopedMappings\n    })\n    return {\n      imports: importsUsed,\n      scopes: scopesUsed,\n    }\n  }\n\n  return composeTwoImportMaps(importMap, { imports, scopes })\n}\n\nconst tryToResolveImport = async ({\n  logger,\n  warn,\n  specifier,\n  importer,\n  importedBy,\n  projectDirectoryUrl,\n  projectPackageFileUrl,\n  trackAndResolveImport,\n  runtime,\n  bareSpecifierAutomapping,\n  extensionlessAutomapping,\n  magicExtensions,\n  performAutomapping,\n}) => {\n  if (runtime === \"node\" && isSpecifierForNodeCoreModule(specifier)) {\n    return null\n  }\n\n  let gotBareSpecifierError = false\n  let fileUrl\n  try {\n    fileUrl = trackAndResolveImport(specifier, importer)\n  } catch (e) {\n    if (e !== BARE_SPECIFIER_ERROR) {\n      throw e\n    }\n    gotBareSpecifierError = true\n    if (importer === projectPackageFileUrl) {\n      // cannot find package main file (package.main is \"\" for instance)\n      // we can't discover main file and parse dependencies\n      return null\n    }\n    fileUrl = resolveUrl(specifier, importer)\n  }\n\n  const { magicExtension, found, url } = await resolveFile(fileUrl, {\n    magicExtensionEnabled: true,\n    magicExtensions: magicExtensionWithImporterExtension(\n      magicExtensions || [],\n      importer,\n    ),\n  })\n\n  const packageDirectoryUrl = packageDirectoryUrlFromUrl(\n    url,\n    projectDirectoryUrl,\n  )\n  const packageFileUrl = resolveUrl(\"package.json\", packageDirectoryUrl)\n  const scope =\n    packageFileUrl === projectPackageFileUrl\n      ? undefined\n      : `./${urlToRelativeUrl(packageDirectoryUrl, projectDirectoryUrl)}`\n  const automapping = {\n    scope,\n    from: specifier,\n    to: `./${urlToRelativeUrl(url, projectDirectoryUrl)}`,\n  }\n\n  if (gotBareSpecifierError) {\n    if (!found) {\n      warn(\n        createImportResolutionFailedWarning({\n          specifier,\n          importedBy,\n          gotBareSpecifierError,\n          suggestsNodeRuntime:\n            runtime !== \"node\" && isSpecifierForNodeCoreModule(specifier),\n        }),\n      )\n      return null\n    }\n\n    if (!bareSpecifierAutomapping) {\n      warn(\n        createImportResolutionFailedWarning({\n          specifier,\n          importedBy,\n          gotBareSpecifierError,\n          automapping,\n        }),\n      )\n      return null\n    }\n    logger.debug(\n      createBareSpecifierAutomappingMessage({\n        specifier,\n        importedBy,\n        automapping,\n      }),\n    )\n    performAutomapping(automapping)\n    return url\n  }\n\n  if (!found) {\n    warn(\n      createImportResolutionFailedWarning({\n        specifier,\n        importedBy,\n      }),\n    )\n    return null\n  }\n\n  if (magicExtension) {\n    if (!extensionlessAutomapping) {\n      const mappingFoundInPackageExports =\n        await extensionIsMappedInPackageExports(packageFileUrl)\n\n      if (!mappingFoundInPackageExports) {\n        warn(\n          createImportResolutionFailedWarning({\n            specifier,\n            importedBy,\n            magicExtension,\n            automapping,\n          }),\n        )\n        return null\n      }\n\n      logger.debug(\n        createExtensionLessAutomappingMessage({\n          specifier,\n          importedBy,\n          automapping,\n          mappingFoundInPackageExports,\n        }),\n      )\n      performAutomapping(automapping)\n      return url\n    }\n\n    logger.debug(\n      createExtensionLessAutomappingMessage({\n        specifier,\n        importedBy,\n        automapping,\n      }),\n    )\n    performAutomapping(automapping)\n    return url\n  }\n\n  return url\n}\n\nconst extensionIsMappedInPackageExports = async (packageFileUrl) => {\n  const closestPackageObject = await readFile(packageFileUrl, {\n    as: \"json\",\n  })\n  // it's imprecise because we are not ensuring the wildcard correspond\n  // to the required mapping, but good enough for now\n  const containsWildcard = Object.keys(closestPackageObject.exports || {}).some(\n    (key) => key.includes(\"*\"),\n  )\n  return containsWildcard\n}\n\nconst packageDirectoryUrlFromUrl = (url, projectDirectoryUrl) => {\n  const relativeUrl = urlToRelativeUrl(url, projectDirectoryUrl)\n\n  const lastNodeModulesDirectoryStartIndex =\n    relativeUrl.lastIndexOf(\"node_modules/\")\n  if (lastNodeModulesDirectoryStartIndex === -1) {\n    return projectDirectoryUrl\n  }\n\n  const lastNodeModulesDirectoryEndIndex =\n    lastNodeModulesDirectoryStartIndex + `node_modules/`.length\n\n  const beforeNodeModulesLastDirectory = relativeUrl.slice(\n    0,\n    lastNodeModulesDirectoryEndIndex,\n  )\n  const afterLastNodeModulesDirectory = relativeUrl.slice(\n    lastNodeModulesDirectoryEndIndex,\n  )\n  const remainingDirectories = afterLastNodeModulesDirectory.split(\"/\")\n\n  if (afterLastNodeModulesDirectory[0] === \"@\") {\n    // scoped package\n    return `${projectDirectoryUrl}${beforeNodeModulesLastDirectory}${remainingDirectories\n      .slice(0, 2)\n      .join(\"/\")}`\n  }\n  return `${projectDirectoryUrl}${beforeNodeModulesLastDirectory}${remainingDirectories[0]}/`\n}\n\nconst magicExtensionWithImporterExtension = (magicExtensions, importer) => {\n  const importerExtension = urlToExtension(importer)\n  const magicExtensionsWithoutImporterExtension = magicExtensions.filter(\n    (ext) => ext !== importerExtension,\n  )\n  return [importerExtension, ...magicExtensionsWithoutImporterExtension]\n}\n",
    "export const importMapToVsCodeConfigPaths = ({ imports = {} }) => {\n  const paths = {}\n\n  Object.keys(imports).forEach((importKey) => {\n    const importValue = imports[importKey]\n\n    let key\n    if (importKey.endsWith(\"/\")) {\n      key = `${importKey}*`\n    } else {\n      key = importKey\n    }\n\n    const importValueArray =\n      typeof importValue === \"string\" ? [importValue] : importValue\n    const candidatesForPath = importValueArray.map((importValue) => {\n      if (importValue.endsWith(\"/\")) {\n        return `${importValue}*`\n      }\n      return importValue\n    })\n\n    if (key in paths) {\n      paths[key] = [...paths[key], ...candidatesForPath]\n    } else {\n      paths[key] = candidatesForPath\n    }\n  })\n\n  return paths\n}\n",
    "import { createLogger } from \"@jsenv/logger\"\nimport {\n  assertAndNormalizeDirectoryUrl,\n  writeFile,\n  resolveUrl,\n  readFile,\n  urlToFileSystemPath,\n} from \"@jsenv/filesystem\"\nimport { sortImportMap } from \"@jsenv/importmap\"\n\nimport { visitNodeModuleResolution } from \"./internal/from-package/visitNodeModuleResolution.js\"\nimport { optimizeImportMap } from \"./internal/optimizeImportMap.js\"\nimport { visitSourceFiles } from \"./internal/from-js/visitSourceFiles.js\"\nimport { importMapToVsCodeConfigPaths } from \"./internal/importMapToVsCodeConfigPaths.js\"\n\nexport const writeImportMapFiles = async ({\n  logLevel,\n  projectDirectoryUrl,\n  importMapFiles,\n  packagesManualOverrides,\n  onWarn = (warning, warn) => {\n    warn(warning)\n  },\n  writeFiles = true,\n  // for unit test\n  jsConfigFileUrl,\n}) => {\n  const logger = createLogger({ logLevel })\n  const warn = wrapWarnToWarnOnce((warning) => {\n    onWarn(warning, () => {\n      logger.warn(`\\n${warning.message}\\n`)\n    })\n  })\n\n  projectDirectoryUrl = assertAndNormalizeDirectoryUrl(projectDirectoryUrl)\n\n  if (typeof importMapFiles !== \"object\" || importMapFiles === null) {\n    throw new TypeError(\n      `importMapFiles must be an object, received ${importMapFiles}`,\n    )\n  }\n  const importMapFileRelativeUrls = Object.keys(importMapFiles)\n  const importMapFileCount = importMapFileRelativeUrls.length\n  if (importMapFileCount.length) {\n    throw new Error(`importMapFiles object is empty`)\n  }\n\n  const importMaps = {}\n  const nodeResolutionVisitors = []\n  importMapFileRelativeUrls.forEach((importMapFileRelativeUrl) => {\n    const importMapConfig = importMapFiles[importMapFileRelativeUrl]\n\n    const { initialImportMap = {} } = importMapConfig\n    const topLevelMappings = initialImportMap.imports || {}\n    const scopedMappings = initialImportMap.scopes || {}\n    const importMap = {\n      imports: topLevelMappings,\n      scopes: scopedMappings,\n    }\n    importMaps[importMapFileRelativeUrl] = importMap\n\n    const {\n      mappingsForNodeResolution,\n      mappingsForDevDependencies,\n      packageUserConditions,\n      packageIncludedPredicate,\n      runtime = \"browser\",\n    } = importMapConfig\n    if (mappingsForNodeResolution) {\n      nodeResolutionVisitors.push({\n        mappingsForDevDependencies,\n        packageConditions: packageConditionsFromPackageUserConditions({\n          runtime,\n          packageUserConditions,\n        }),\n        packageIncludedPredicate,\n        onMapping: ({ scope, from, to }) => {\n          if (scope) {\n            scopedMappings[scope] = {\n              ...(scopedMappings[scope] || {}),\n              [from]: to,\n            }\n          } else {\n            topLevelMappings[from] = to\n          }\n        },\n      })\n    }\n  })\n\n  if (nodeResolutionVisitors.length > 0) {\n    await visitNodeModuleResolution({\n      logger,\n      warn,\n      projectDirectoryUrl,\n      visitors: nodeResolutionVisitors,\n      packagesManualOverrides,\n    })\n  }\n\n  await importMapFileRelativeUrls.reduce(\n    async (previous, importMapFileRelativeUrl) => {\n      const importMapConfig = importMapFiles[importMapFileRelativeUrl]\n      const {\n        checkImportResolution,\n        // ideally we could enable extensionlessAutomapping and bareSpecifierAutomappingonly for a subset\n        // of files. Not that hard to do, especially using @jsenv/url-meta\n        // but that's super extra fine tuning that I don't have time/energy to do for now\n        bareSpecifierAutomapping,\n        extensionlessAutomapping,\n        magicExtensions,\n        removeUnusedMappings,\n        runtime = \"browser\",\n      } = importMapConfig\n\n      if (\n        checkImportResolution ||\n        bareSpecifierAutomapping ||\n        extensionlessAutomapping ||\n        removeUnusedMappings\n      ) {\n        if (checkImportResolution === false) {\n          logger.warn(\n            `\"checkImportResolution\" cannot be disabled when automapping or \"removeUnusedMappings\" are enabled`,\n          )\n        }\n        if (extensionlessAutomapping && !magicExtensions) {\n          logger.warn(\n            `\"magicExtensions\" is required when \"extensionlessAutomapping\" is enabled`,\n          )\n        }\n\n        const importMap = await visitSourceFiles({\n          logger,\n          warn,\n          projectDirectoryUrl,\n          importMap: importMaps[importMapFileRelativeUrl],\n          bareSpecifierAutomapping,\n          extensionlessAutomapping,\n          magicExtensions,\n          removeUnusedMappings,\n          runtime,\n        })\n        importMaps[importMapFileRelativeUrl] = importMap\n      }\n    },\n    Promise.resolve(),\n  )\n\n  Object.keys(importMaps).forEach((key) => {\n    const importMap = importMaps[key]\n    const importMapNormalized = sortImportMap(optimizeImportMap(importMap))\n    importMaps[key] = importMapNormalized\n  })\n\n  if (writeFiles) {\n    await importMapFileRelativeUrls.reduce(\n      async (previous, importMapFileRelativeUrl) => {\n        await previous\n        const importmapFileUrl = resolveUrl(\n          importMapFileRelativeUrl,\n          projectDirectoryUrl,\n        )\n        const importMap = importMaps[importMapFileRelativeUrl]\n        await writeFile(importmapFileUrl, JSON.stringify(importMap, null, \"  \"))\n        logger.info(`-> ${urlToFileSystemPath(importmapFileUrl)}`)\n      },\n      Promise.resolve(),\n    )\n  }\n\n  const firstUpdatingJsConfig = importMapFileRelativeUrls.find(\n    (importMapFileRelativeUrl) => {\n      const importMapFileConfig = importMapFiles[importMapFileRelativeUrl]\n      return importMapFileConfig.useForJsConfigJSON\n    },\n  )\n  if (firstUpdatingJsConfig) {\n    jsConfigFileUrl =\n      jsConfigFileUrl || resolveUrl(\"./jsconfig.json\", projectDirectoryUrl)\n    const jsConfigCurrent = (await readCurrentJsConfig(jsConfigFileUrl)) || {\n      compilerOptions: {},\n    }\n    const importMapUsedForVsCode = importMaps[firstUpdatingJsConfig]\n    const jsConfigPaths = importMapToVsCodeConfigPaths(importMapUsedForVsCode)\n    const jsConfig = {\n      ...jsConfigDefault,\n      ...jsConfigCurrent,\n      compilerOptions: {\n        ...jsConfigDefault.compilerOptions,\n        ...jsConfigCurrent.compilerOptions,\n        // importmap is the source of truth -> paths are overwritten\n        // We coudldn't differentiate which one we created and which one where added manually anyway\n        paths: jsConfigPaths,\n      },\n    }\n    await writeFile(jsConfigFileUrl, JSON.stringify(jsConfig, null, \"  \"))\n    logger.info(`-> ${urlToFileSystemPath(jsConfigFileUrl)}`)\n  }\n\n  return importMaps\n}\n\nconst packageConditionsFromPackageUserConditions = ({\n  runtime,\n  packageUserConditions,\n}) => {\n  if (typeof packageUserConditions === \"undefined\") {\n    return [\"import\", runtime, \"default\"]\n  }\n\n  if (!Array.isArray(packageUserConditions)) {\n    throw new TypeError(\n      `packageUserConditions must be an array, got ${packageUserConditions}`,\n    )\n  }\n\n  packageUserConditions.forEach((userCondition) => {\n    if (typeof userCondition !== \"string\") {\n      throw new TypeError(\n        `user condition must be a string, got ${userCondition}`,\n      )\n    }\n  })\n\n  return [...packageUserConditions, \"import\", runtime, \"default\"]\n}\n\nconst wrapWarnToWarnOnce = (warn) => {\n  const warnings = []\n  return (warning) => {\n    const alreadyWarned = warnings.some((warningCandidate) => {\n      return JSON.stringify(warningCandidate) === JSON.stringify(warning)\n    })\n    if (alreadyWarned) {\n      return\n    }\n\n    if (warnings.length > 1000) {\n      warnings.shift()\n    }\n    warnings.push(warning)\n    warn(warning)\n  }\n}\n\nconst jsConfigDefault = {\n  compilerOptions: {\n    baseUrl: \".\",\n    paths: {},\n  },\n}\n\nconst readCurrentJsConfig = async (jsConfigFileUrl) => {\n  try {\n    const currentJSConfig = await readFile(jsConfigFileUrl, { as: \"json\" })\n    return currentJSConfig\n  } catch (e) {\n    return null\n  }\n}\n"
  ],
  "names": [
    "createPackageNameMustBeAStringWarning",
    "packageName",
    "packageInfo",
    "code",
    "message",
    "urlToFileSystemPath",
    "url",
    "createImportResolutionFailedWarning",
    "specifier",
    "importedBy",
    "gotBareSpecifierError",
    "magicExtension",
    "suggestsNodeRuntime",
    "automapping",
    "createDetailedMessage",
    "getImportResolutionFailedSuggestions",
    "createBareSpecifierAutomappingMessage",
    "mappingToImportmapString",
    "createExtensionLessAutomappingMessage",
    "mappingFoundInPackageExports",
    "suggestions",
    "addSuggestion",
    "suggestion",
    "suggestionCount",
    "Object",
    "keys",
    "length",
    "mappingToUrlRelativeToFile",
    "mapping",
    "scope",
    "to",
    "scopeUrl",
    "resolveUrl",
    "toUrl",
    "urlToRelativeUrl",
    "from",
    "JSON",
    "stringify",
    "scopes",
    "imports",
    "resolveFile",
    "fileUrl",
    "magicDirectoryIndexEnabled",
    "magicExtensionEnabled",
    "magicExtensions",
    "fileStat",
    "readFileSystemNodeStat",
    "nullIfNotFound",
    "isFile",
    "found",
    "isDirectory",
    "indexFileSuffix",
    "endsWith",
    "indexFileUrl",
    "result",
    "magicDirectoryIndex",
    "extension",
    "urlToExtension",
    "extensionLeadingToAFile",
    "findExtensionLeadingToFile",
    "urlDirectoryUrl",
    "urlFilename",
    "urlToFilename",
    "extensionLeadingToFile",
    "firstOperationMatching",
    "array",
    "start",
    "extensionCandidate",
    "urlCandidate",
    "stats",
    "predicate",
    "Boolean",
    "resolvePackageMain",
    "warn",
    "object",
    "resolveMainFile",
    "packageFileUrl",
    "packageMainFieldName",
    "packageMainFieldValue",
    "main",
    "packageDirectoryUrl",
    "mainFileRelativeUrl",
    "mainFileUrlFirstCandidate",
    "startsWith",
    "createPackageMainFileMustBeRelativeWarning",
    "createPackageMainFileNotFoundWarning",
    "importedIn",
    "join",
    "visitPackageImportMap",
    "packageImportmap",
    "importmap",
    "projectDirectoryUrl",
    "importmapFileUrl",
    "readFile",
    "as",
    "moveImportMap",
    "e",
    "createPackageImportMapNotFoundWarning",
    "createPackageImportMapUnexpectedWarning",
    "specifierIsRelative",
    "test",
    "visitPackageImports",
    "packageImports",
    "packageConditions",
    "importsSubpaths",
    "onImportsSubpath",
    "key",
    "value",
    "trace",
    "createSubpathValueMustBeRelativeWarning",
    "valueTrace",
    "keyNormalized",
    "valueNormalized",
    "visitSubpathValue",
    "subpathValue",
    "subpathValueTrace",
    "handleString",
    "handleObject",
    "handleRemaining",
    "firstBareKey",
    "slice",
    "reverse",
    "find",
    "followConditionBranch",
    "conditionTrace",
    "bareKeys",
    "conditionalKeys",
    "forEach",
    "availableKey",
    "push",
    "createSubpathKeysAreMixedWarning",
    "leadsToSomething",
    "some",
    "keyCandidate",
    "includes",
    "valueCandidate",
    "createSubpathIsUnexpectedWarning",
    "visitPackageExports",
    "packageExports",
    "exports",
    "name",
    "exportsSubpaths",
    "packageDirectoryRelativeUrl",
    "onExportsSubpath",
    "specifierToSource",
    "addressToDestination",
    "handleFalse",
    "firstRelativeKey",
    "relativeKeys",
    "Array",
    "isArray",
    "exportsObjectFromExportsArray",
    "exportsArray",
    "exportsObject",
    "exportValue",
    "assign",
    "default",
    "address",
    "memoizeAsyncFunctionByUrl",
    "fn",
    "cache",
    "memoizeAsyncFunction",
    "getMemoryEntryFromArguments",
    "get",
    "set",
    "promise",
    "delete",
    "memoizeAsyncFunctionBySpecifierAndImporter",
    "importerCache",
    "importer",
    "specifierCacheForImporter",
    "memoized",
    "args",
    "memoryEntry",
    "promiseFromMemory",
    "resolve",
    "reject",
    "createControllablePromise",
    "error",
    "isInMemory",
    "Promise",
    "res",
    "rej",
    "PACKAGE_NOT_FOUND",
    "PACKAGE_WITH_SYNTAX_ERROR",
    "readPackageFile",
    "packageObject",
    "console",
    "formatPackageSyntaxErrorLog",
    "syntaxError",
    "applyPackageManualOverride",
    "packagesManualOverrides",
    "version",
    "overrideKey",
    "overrideKeyCandidate",
    "composeObject",
    "leftObject",
    "rightObject",
    "composedObject",
    "rightValue",
    "leftValue",
    "createFindNodeModulePackage",
    "readPackageFileMemoized",
    "dependencyName",
    "nodeModuleCandidates",
    "getNodeModuleCandidates",
    "nodeModuleCandidate",
    "packageFileUrlCandidate",
    "packageObjectCandidate",
    "packageJsonObject",
    "fileDirectoryUrl",
    "fileDirectoryRelativeUrl",
    "candidates",
    "relativeNodeModuleDirectoryArray",
    "split",
    "shift",
    "i",
    "visitNodeModuleResolution",
    "logger",
    "visitors",
    "projectPackageFileUrl",
    "findNodeModulePackage",
    "seen",
    "markPackageAsSeen",
    "importerPackageFileUrl",
    "packageIsSeen",
    "visit",
    "packageVisitors",
    "packageImporterInfo",
    "filter",
    "visitor",
    "packageIncludedPredicate",
    "visitDependencies",
    "visitPackage",
    "dependencyMap",
    "packageDependenciesFromPackageObject",
    "all",
    "map",
    "dependencyInfo",
    "type",
    "visitorsForDevDependencies",
    "mappingsForDevDependencies",
    "visitDependency",
    "dependencyData",
    "findDependency",
    "cannotFindPackageWarning",
    "createCannotFindPackageWarning",
    "isOptional",
    "debug",
    "dependencyPackageFileUrl",
    "dependencyPackageJsonObject",
    "packageDerivedInfo",
    "computePackageDerivedInfo",
    "addImportMapForPackage",
    "importMap",
    "packageIsRoot",
    "triggerVisitorOnMapping",
    "scopeMappings",
    "toMoved",
    "moveMappingValue",
    "scopeMoved",
    "addMappingsForPackageAndImporter",
    "mappings",
    "importerIsRoot",
    "importerRelativeUrl",
    "importsFromPackageField",
    "mappingsFromPackageImports",
    "mappingsFromPackageExports",
    "indexOf",
    "fromWithouTrailingStar",
    "toWithoutTrailingStar",
    "createExportsWildcardIgnoredWarning",
    "visitPackageMain",
    "packageDirectoryUrlExpected",
    "reduce",
    "previous",
    "mainFileUrl",
    "nodeResolutionConditions",
    "dependenciesCache",
    "dependencyPromise",
    "projectPackageObject",
    "Error",
    "lastIndexOf",
    "onMapping",
    "packageDependencies",
    "dependencies",
    "optionalDependencies",
    "versionPattern",
    "peerDependencies",
    "peerDependenciesMeta",
    "optional",
    "devDependencies",
    "hasOwnProperty",
    "relativeUrl",
    "importerPackageDirectoryUrl",
    "dependencyIsOptional",
    "dependencyType",
    "dependencyVersionPattern",
    "optimizeImportMap",
    "scopesOptimized",
    "scopeMappingsOptimized",
    "mappingKey",
    "topLevelMappingValue",
    "mappingValue",
    "filenameContainsBackSlashes",
    "__filename",
    "replace",
    "require",
    "createRequire",
    "parser",
    "traverse",
    "parseSpecifiersFromFile",
    "fileContent",
    "jsFilesParsingOptions",
    "undefined",
    "fileExtension",
    "jsx",
    "typescript",
    "flow",
    "ast",
    "parse",
    "sourceType",
    "sourceFilename",
    "plugins",
    "ranges",
    "specifiers",
    "addSpecifier",
    "path",
    "node",
    "line",
    "loc",
    "column",
    "CallExpression",
    "callee",
    "arguments",
    "ExportAllDeclaration",
    "ExportNamedDeclaration",
    "source",
    "ImportDeclaration",
    "showSource",
    "showSourceLocation",
    "red",
    "grey",
    "ansiResetSequence",
    "numberOfSurroundingLinesToShow",
    "lineMaxLength",
    "color",
    "markColor",
    "asideColor",
    "colorMark",
    "string",
    "colorAside",
    "mark",
    "aside",
    "lines",
    "lineRange",
    "end",
    "moveLineRangeUp",
    "moveLineRangeDown",
    "lineRangeWithinLines",
    "linesToShow",
    "endLineNumber",
    "lineNumberMaxWidth",
    "String",
    "columnRange",
    "Math",
    "floor",
    "ceil",
    "lineSource",
    "index",
    "lineNumber",
    "isMainLine",
    "lineSourceTruncated",
    "applyColumnRange",
    "lineNumberWidth",
    "lineNumberRightSpacing",
    "repeat",
    "asideSource",
    "lineFormatted",
    "lineSourceUntilColumn",
    "spacing",
    "stringToSpaces",
    "mainLineFormatted",
    "TypeError",
    "prefix",
    "suffix",
    "lastIndex",
    "startTruncated",
    "endTruncated",
    "number",
    "BARE_SPECIFIER_ERROR",
    "visitSourceFiles",
    "runtime",
    "bareSpecifierAutomapping",
    "extensionlessAutomapping",
    "removeUnusedMappings",
    "addMapping",
    "topLevelMappingsUsed",
    "scopedMappingsUsed",
    "markMappingAsUsed",
    "importMapNormalized",
    "normalizeImportMap",
    "trackAndResolveImport",
    "resolveImport",
    "defaultExtension",
    "onImportMapping",
    "createBareSpecifierError",
    "testImportResolution",
    "tryToResolveImport",
    "performAutomapping",
    "visitFile",
    "specifierInfo",
    "dependencyUrlOnFileSystem",
    "dependenciesToVisit",
    "dependency",
    "projectPackageName",
    "projectMainFileUrlOnFileSystem",
    "importsUsed",
    "scopesUsed",
    "mappingsUsed",
    "scopedMappings",
    "composeTwoImportMaps",
    "isSpecifierForNodeCoreModule",
    "magicExtensionWithImporterExtension",
    "packageDirectoryUrlFromUrl",
    "extensionIsMappedInPackageExports",
    "closestPackageObject",
    "containsWildcard",
    "lastNodeModulesDirectoryStartIndex",
    "lastNodeModulesDirectoryEndIndex",
    "beforeNodeModulesLastDirectory",
    "afterLastNodeModulesDirectory",
    "remainingDirectories",
    "importerExtension",
    "magicExtensionsWithoutImporterExtension",
    "ext",
    "importMapToVsCodeConfigPaths",
    "paths",
    "importKey",
    "importValue",
    "importValueArray",
    "candidatesForPath",
    "writeImportMapFiles",
    "logLevel",
    "importMapFiles",
    "onWarn",
    "warning",
    "writeFiles",
    "jsConfigFileUrl",
    "createLogger",
    "wrapWarnToWarnOnce",
    "assertAndNormalizeDirectoryUrl",
    "importMapFileRelativeUrls",
    "importMapFileCount",
    "importMaps",
    "nodeResolutionVisitors",
    "importMapFileRelativeUrl",
    "importMapConfig",
    "initialImportMap",
    "topLevelMappings",
    "mappingsForNodeResolution",
    "packageUserConditions",
    "packageConditionsFromPackageUserConditions",
    "checkImportResolution",
    "sortImportMap",
    "writeFile",
    "info",
    "firstUpdatingJsConfig",
    "importMapFileConfig",
    "useForJsConfigJSON",
    "jsConfigCurrent",
    "readCurrentJsConfig",
    "compilerOptions",
    "importMapUsedForVsCode",
    "jsConfigPaths",
    "jsConfig",
    "jsConfigDefault",
    "userCondition",
    "warnings",
    "alreadyWarned",
    "warningCandidate",
    "baseUrl",
    "currentJSConfig"
  ],
  "mappings": "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"
}